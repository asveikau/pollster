
ifndef LIBCOMMON_ROOT
LIBCOMMON_ROOT=$(LIBPOLLSTER_ROOT)../common/
endif
include $(LIBCOMMON_ROOT)Makefile.inc

LIBPOLLSTER_CXXFLAGS += -fno-rtti
LIBPOLLSTER_CXXFLAGS += -I$(LIBCOMMON_ROOT)include
LIBPOLLSTER_CXXFLAGS += -I$(LIBPOLLSTER_ROOT)include

LIBPOLLSTER_SRC += \
   $(LIBPOLLSTER_ROOT)src/backends.cc \
   $(LIBPOLLSTER_ROOT)src/timer.cc

ifeq ($(PLATFORM), windows)
LIBPOLLSTER_SRC += \
   $(LIBPOLLSTER_ROOT)src/win.cc
else
LIBPOLLSTER_SRC += \
   $(LIBPOLLSTER_ROOT)src/unix.cc
endif

ifneq (, $(filter $(PLATFORM),freebsd openbsd darwin))
LIBPOLLSTER_SRC += \
   $(LIBPOLLSTER_ROOT)src/kqueue.cc
LIBPOLLSTER_CXXFLAGS += -DUSE_KQUEUE
endif

ifeq ($(PLATFORM),linux)
LIBPOLLSTER_SRC += \
   $(LIBPOLLSTER_ROOT)src/epoll.cc
LIBPOLLSTER_CXXFLAGS += -DUSE_EPOLL
endif

ifneq ($(PLATFORM), windows)
LIBPOLLSTER_SRC += \
   $(LIBPOLLSTER_ROOT)src/poll.cc
LIBPOLLSTER_CXXFLAGS += -DUSE_POLL
endif

LIBPOLLSTER_OBJS := $(shell $(SRC2OBJ) $(LIBPOLLSTER_SRC))

LIBPOLLSTER=$(LIBPOLLSTER_ROOT)$(LIBPREFIX)pollster$(LIBSUFFIX)

$(LIBPOLLSTER): ${LIBPOLLSTER_OBJS}
	$(LIBWRAPPER) $(LIBPOLLSTER_OBJS)

-include $(LIBPOLLSTER_ROOT)depend.mk

